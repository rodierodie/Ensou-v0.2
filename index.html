<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordPlayer - Изучение музыкальной гармонии</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Загрузка внешних библиотек -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.5/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/midi-writer-js@3.1.1/browser/midiwriter.min.js"></script>
    
    <!-- Загрузка глобальных данных (для обратной совместимости) -->
    <script src="js/tonality.js"></script>
    <script src="js/chords.js"></script>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="logo">ChordPlayer</div>
            <div class="playback-controls">
                <div class="tempo-control">
                    <label for="tempo-input">Темп:</label>
                    <input type="number" id="tempo-input" value="120" min="40" max="240">
                    <span>BPM</span>
                </div>
                <div class="arpeggiator-toggle">
                    <span>ARP:</span>
                    <button id="arp-toggle" class="toggle-button">Выкл</button>
                </div>
                <div class="metronome-toggle">
                    <label class="checkbox-container">
                        <input type="checkbox" id="metronome-checkbox">
                        <span class="checkbox-label">Метроном</span>
                    </label>
                </div>
                <div class="main-controls">
                    <button id="play-button" class="play-button">▶</button>
                    <button id="stop-button" class="stop-button" disabled>■</button>
                </div>
            </div>
        </header>

        <main class="app-content">
            <!-- Блоки трека -->
            <section class="blocks-tabs">
                <div id="block-tabs-container" class="block-tabs-container">
                    <!-- Блоки будут добавляться динамически -->
                </div>
            </section>

            <!-- Активный блок -->
            <section class="active-block" id="current-block">
                <div class="block-header">
                    <h2 class="block-title">A1</h2>
                    <button class="duplicate-block">+ Дублировать блок</button>
                </div>

                <!-- Селектор тональности -->
                <div class="tonality-section">
                    <div id="tonality-selector-container" class="tonality-selector-container">
                        <!-- Тональность будет добавлена динамически -->
                    </div>
                    <button id="toggle-circle" class="toggle-circle">Скрыть круг тональностей</button>
                    <div id="tonality-circle-container" class="tonality-circle-container">
                        <!-- Круг тональностей будет добавлен динамически -->
                    </div>
                </div>

                <!-- Секция с аккордами -->
                <div class="chord-sections">
                    <div class="chord-section">
                        <h3>Основные аккорды</h3>
                        <div id="basic-chords" class="chord-grid">
                            <!-- Аккорды будут добавлены динамически -->
                        </div>
                    </div>
                    <div class="chord-section">
                        <h3>Септаккорды</h3>
                        <div id="seventh-chords" class="chord-grid">
                            <!-- Септаккорды будут добавлены динамически -->
                        </div>
                    </div>
                </div>

                <!-- Информация об аккорде -->
                <div class="chord-info-section" id="chord-info-section">
                    <!-- Информация будет добавлена динамически -->
                </div>

                <!-- Секвенция аккордов -->
                <div class="sequence-section">
                    <h3>Секвенция</h3>
                    <div class="sequence-controls">
                        <div class="sequence-actions">
                            <button id="add-chord" class="add-chord-button">+ Аккорд</button>
                            <button id="add-pause" class="add-pause-button">+ Пауза</button>
                            <button id="clear-sequence" class="clear-button">Очистить</button>
                        </div>
                    </div>
                    <div id="sequence-container" class="sequence-container">
                        <!-- Элементы секвенции будут добавлены динамически -->
                    </div>
                    <div class="export-controls">
                        <button id="export-midi" class="export-button">Экспорт в MIDI</button>
                        <button id="export-text" class="export-button">Экспорт в текст</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Подвал -->
        <footer class="app-footer">
            <div class="version">
                <span>Версия 2.0</span>
            </div>
            <div class="actions">
                <button id="export-track-midi" class="export-button">Экспорт трека в MIDI</button>
                <button id="export-track-text" class="export-button">Экспорт трека в текст</button>
                <button id="export-data" class="export-button">Сохранить проект</button>
                <label for="import-data" class="import-button">Загрузить проект
                    <input type="file" id="import-data" accept=".json" style="display: none;">
                </label>
            </div>
        </footer>
    </div>

    <!-- Модальные окна -->
    <div id="modal-container" class="modal-container hidden">
        <!-- Содержимое модальных окон будет добавляться динамически -->
    </div>

    <!-- Новая архитектура приложения -->
    <script type="module" src="js/app.js"></script>
    
    <!-- Запасной вариант для браузеров, не поддерживающих ES модули -->
    <script nomodule>
        alert('Ваш браузер не поддерживает ES модули. Пожалуйста, используйте современный браузер.');
    </script>
</body>
</html>